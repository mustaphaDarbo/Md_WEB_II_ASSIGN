<div class="dashboard-wrapper">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-brand">
      <div class="brand-logo">CM</div>
      <div class="brand-text">CONTENTFLOW CMS</div>
    </div>
    
    <nav class="nav-menu">
      <!-- Create Article - Always show for SuperAdmin -->
      <a routerLink="/articles" (click)="setViewMode('create')" [routerLinkActive]="viewMode === 'create' ? 'active' : ''" class="nav-item" [class.active]="viewMode === 'create'" *ngIf="isSuperAdmin || auth.hasPermission('create')">
        <span class="nav-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 6h16M4 12h16M4 18h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </span>
        <span>Create Article</span>
      </a>

      <!-- Articles Library - Always show -->
      <a routerLink="/articles" (click)="setViewMode('library')" [routerLinkActive]="viewMode === 'library' ? 'active' : ''" class="nav-item" [class.active]="viewMode === 'library'">
        <span class="nav-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 4h16v16H4V4Z" stroke="currentColor" stroke-width="2"/><path d="M8 8h8M8 12h8M8 16h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </span>
        <span>Articles Library</span>
      </a>

      <!-- Users Management - Always show for SuperAdmin -->
      <a routerLink="/users" routerLinkActive="active" class="nav-item" *ngIf="isSuperAdmin">
        <span class="nav-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16 11c1.66 0 3-1.34 3-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3ZM8 11c1.66 0 3-1.34 3-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3Z" fill="currentColor"/><path d="M16 13c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4Zm-8 0c-.29 0-.62.02-.97.05C5.1 13.36 2 14.45 2 17v2h6v-2.2c0-1.32.7-2.42 1.8-3.25-.57-.23-1.18-.55-1.8-.55Z" fill="currentColor"/></svg>
        </span>
        <span>Users</span>
      </a>

      <!-- Roles Management - Always show for SuperAdmin -->
      <a routerLink="/roles" routerLinkActive="active" class="nav-item" *ngIf="isSuperAdmin">
        <span class="nav-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2 4 5v6c0 5 3.4 9.4 8 11 4.6-1.6 8-6 8-11V5l-8-3Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>
        </span>
        <span>Roles &amp; Permissions</span>
      </a>

      <!-- Access Matrix - Always show -->
      <a routerLink="/access-matrix" routerLinkActive="active" class="nav-item">
        <span class="nav-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 3h18v18H3V3Z" stroke="currentColor" stroke-width="2"/><path d="M3 9h18M3 15h18M9 3v18" stroke="currentColor" stroke-width="2"/></svg>
        </span>
        <span>Access Matrix</span>
      </a>

      <button type="button" (click)="logout()" class="nav-item logout">
        <span class="nav-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 17l-1 0c-3 0-5-2-5-5s2-5 5-5h1" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M14 7l5 5-5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M19 12H10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </span>
        <span>Logout</span>
      </button>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <header class="topbar">
      <div class="topbar-left">
        <button type="button" class="icon-btn" aria-label="Menu">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 7h16M4 12h10M4 17h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </button>
      </div>

      <div class="topbar-center">
        <div class="search-pill">
          <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M10.5 18a7.5 7.5 0 1 0 0-15 7.5 7.5 0 0 0 0 15Z" stroke="currentColor" stroke-width="2"/></svg>
          <input
            type="text"
            placeholder="Search..."
            [(ngModel)]="searchTerm"
            (input)="searchArticles()"
          />
        </div>
      </div>

      <div class="topbar-right">
        <div class="user-chip">
          <span class="user-greeting">Hi,&nbsp;{{ user?.fullName || 'User' }}</span>
          <input
            #profileFileInput
            type="file"
            accept="image/*"
            class="file-input"
            (change)="onProfileFileSelected($event)"
          />
          <button
            type="button"
            class="avatar"
            [attr.title]="'Click to change photo'"
            (click)="triggerProfilePicker()"
          >
            <img *ngIf="profilePhotoUrl" [src]="profilePhotoUrl" alt="Profile" />
            <span *ngIf="!profilePhotoUrl">{{ userInitials }}</span>
          </button>
        </div>
      </div>
    </header>

    <!-- Content Area -->
    <div class="content-area">
      <!-- Create View -->
      <div *ngIf="viewMode === 'create'">
        <div class="page-header">
          <h1>Create Article</h1>
          <div class="page-subtitle">Write and publish new articles</div>
        </div>

        <!-- Create Article Form -->
        <div class="articles-container">
          <div class="article-card create-article-card">
            <div class="article-header">
              <h3>Create New Article</h3>
            </div>
            
            <form (ngSubmit)="createArticle()" class="create-article-form">
              <input
                type="text"
                name="title"
                [(ngModel)]="newArticle.title"
                placeholder="Article Title"
                required
                class="article-input"
              />
              
              <textarea
                name="body"
                [(ngModel)]="newArticle.body"
                placeholder="Article Content"
                required
                class="article-textarea"
                rows="10"
              ></textarea>
              
              <!-- Image Upload -->
              <div class="image-upload-section">
                <label class="image-upload-label">Article Image (Optional)</label>
                <input
                  type="file"
                  name="image"
                  accept="image/*"
                  class="article-image-input"
                  (change)="onArticleImageSelected($event)"
                />
                <div *ngIf="articleImageUrl" class="image-preview">
                  <img [src]="articleImageUrl" alt="Article image preview" />
                  <button type="button" class="remove-image-btn" (click)="removeArticleImage()">Remove</button>
                </div>
              </div>
              
              <div class="form-actions">
                <button type="button" (click)="createArticle()" class="test-btn">Test Create</button>
                <button type="submit" class="create-article-btn">Create Article</button>
                <button type="button" (click)="resetForm()" class="cancel-btn">Cancel</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Library View -->
      <div *ngIf="viewMode === 'library'">
        <div class="page-header">
          <h1>Articles Library</h1>
          <div class="page-subtitle">View and manage all articles</div>
        </div>

        <!-- Articles Grid -->
        <div class="articles-container">
          <div *ngFor="let article of filteredArticles" class="article-card">
            <div class="article-header">
              <h3>{{ article.title }}</h3>
              <div class="article-meta">
                <span class="article-date">
                  {{ formatDate(article.createdAt) }}
                </span>
                <span class="article-author">
                  By: {{ article.author?.fullName || article.author || 'Unknown' }}
                </span>
              </div>
            </div>
            
            <div class="article-content">
              <p>{{ article.body?.substring(0, 150) || 'No content' }}...</p>
            </div>

            <div class="article-footer">
              <span class="status-badge" [class.published]="article.published" [class.draft]="!article.published">
                {{ article.published ? 'Published' : 'Draft' }}
              </span>
            </div>
            
            <!-- Admin Actions - Always show for testing -->
            <div class="article-actions">
              <button class="action-btn edit-btn" (click)="editArticle(article)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                Edit
              </button>
              <button class="action-btn publish-btn" 
                      *ngIf="!article.published" 
                      (click)="publishArticle(article._id)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                Publish
              </button>
              <button class="action-btn unpublish-btn" 
                      *ngIf="article.published" 
                      (click)="unpublishArticle(article._id)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M19 12H5M12 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                Unpublish
              </button>
              <button class="action-btn delete-btn" (click)="deleteArticle(article._id)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m3 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6h14zM10 11v6M14 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                Delete
              </button>
            </div>
          </div>

          <div *ngIf="filteredArticles.length === 0" class="no-articles">
            <p>No articles found. Create your first article to get started.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
